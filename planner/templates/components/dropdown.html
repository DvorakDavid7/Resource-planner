<div class="row">
    <div class="col-md-6">
        <div class="dropdown">
            <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" onclick="get_names()">Add worker<span class="caret"></span></button>
            <div id="menu" class="dropdown-menu w-100" style="height: auto; max-height: 500px; overflow-x: hidden;">
                <input class="form-control" id="myInput" type="text" placeholder="Search..">
            </div>
        </div>
    </div>
</div>

<script>
    function get_names() {
        let menu = document.getElementById("menu")
        if (document.getElementsByClassName("dropdown-item").length != 0) return
        fetch("/project_edit/get_names")
        .then(response => response.json())
        .then(data => {
            let names = data.data
            names.forEach(row => {
                let item = document.createElement("A");
                item.innerText = row[2]
                item.classList.add("dropdown-item")
                item.href = "javascript:;"
                item.addEventListener("click", () => add_worker(row[0]))
                menu.appendChild(item)
            });
        });
    }

    function add_worker(worker_id) {
        let record = {
            "project_id": window.location.pathname.split("/").pop(),
            "worker_id": worker_id,
            "week": table_header.weeks[0],
            "value": "0",
            "year": table_header.year_start
        }
        fetch('/project_edit/add_worker', {
                method: 'POST',
                body:JSON.stringify(record),
            }
        )
        .then(response => response.json())
        .then(data => {
            console.log("succes", data);
            location.reload();
        })
    }

    $(document).ready(function(){
        $("#myInput").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $(".dropdown-menu a").filter(function() {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
</script>