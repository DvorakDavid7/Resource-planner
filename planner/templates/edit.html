{% extends "layout.html" %}


{% block content%}
<br>
<div id="set_user">
    <input id="user_id" type="text" placeholder="Enter userID">
    <button onclick="set_user_id()" type="button">Submit</button>
</div>
{{ user_id }}


<div class="dropdown">
    <button onclick="dropdown_toggle();show_data_list({{ table }});" class="dropbtn">Add new project</button>
    <div id="myDropdown" class="dropdown-content">
        <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()">
        <div class="dropdown_list" id="dropdown"></div>
    </div>
</div>

<table id="edit-table" border="1">
    <thead>
        <tr>
            <th>Week:</th>
            {% for i in range(table.header.weeks | length) -%}
            <th class="week_number">{{ table.header.weeks[i] | string + ' (' +  table.header.working_hours[table.header.weeks[i]] + ')' }}</th class="week_number">
            {%- endfor %}
        </tr>
        <tr>
            <td>Dates:</td>
            {% for date in table.header.dates -%}
            <td>{{ date }}</td>
            {%- endfor %}
        </tr>
    </thead>
    
    <tbody>
        {% for i in range(table.body.projects | length) -%}
        <tr>
            <td>{{ table.body.projects[i].name + ' (' + table.body.projects[i].project_manager + ')' }}</td>
            {% for week in table.header.weeks -%}
            {% set week = week | int %}
            <td onkeyup="compute_sum({{ table }})" class="data" contenteditable="true">{{ table["body"]["projects"][i]["values"][week] }}</td>
            {%- endfor %}
            <td><button class="btn btn-danger btn-sm" type="button" onclick="delete_row({{ i }}, {{ table.header }}); compute_sum({{ table }});">X</button></td>
            <td><button class="btn btn-success btn-sm" onclick="auto_insert({{ i }}, {{ table }});compute_sum({{ table }});">A</button></td>
            <td><input size="1" onkeyup="multiple_insert({{ i }}, {{ table.header }});compute_sum({{ table }});" class="multiple_insert" type="text"></td>
        </tr>
        {%- endfor %}

        {% for i in range(table.body.opportunity | length) -%}
        <tr>
            <td><i>{{ table.body.opportunity[i].name  + ' (' + table.body.opportunity[i].project_manager + ')' }}</i></td>
            {% for week in table.header.weeks -%}
            {% set week = week | int %}
            <td onkeyup="compute_sum({{ table }})" class="data" contenteditable="true">{{ table["body"]["opportunity"][i]["values"][week] }}</td>
            {%- endfor %}
            <td><button class="btn btn-danger btn-sm" type="button" onclick="delete_row({{ table.body.projects | length + i }}, {{ table.header }}); compute_sum({{ table }});">X</button></td>
            <td><button class="btn btn-success btn-sm" onclick="auto_insert({{ table.body.projects | length + i }}, {{ table }});compute_sum({{ table }});">A</button></td>
            <td><input size="1" onkeyup="multiple_insert({{ table.body.projects | length + i }}, {{ table.header }});compute_sum({{ table }});" class="multiple_insert" type="text"></td>
        </tr>
        {%- endfor %}
        <tr>
            <td>sum:</td>
            {% for i in range(table.header.weeks | length) -%}
            <td class="sum"></td>
            {% endfor %}
        </tr>
    </tbody>
</table>
<button type="button" onclick="send_changes_from_edit({{ table }})">Save Changes</button>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>compute_sum({{ table | tojson() }})</script>
<script>
    $('.data').on('focus', function() {
      var cell = this;
      var range, selection;
      if (document.body.createTextRange) {
        range = document.body.createTextRange();
        range.moveToElementText(cell);
        range.select();
      } else if (window.getSelection) {
        selection = window.getSelection();
        range = document.createRange();
        range.selectNodeContents(cell);
        selection.removeAllRanges();
        selection.addRange(range);
      }
    });
</script>
{% endblock content %}